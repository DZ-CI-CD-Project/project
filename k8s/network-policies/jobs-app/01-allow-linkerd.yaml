apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-linkerd
  namespace: jobs-app
spec:
  podSelector: {}  # 모든 파드에 적용
  policyTypes:
  - Ingress
  - Egress
  ingress:
  # Linkerd proxy 간 통신 허용 (같은 네임스페이스 내)
  - from:
    - podSelector: {}  # 같은 네임스페이스의 모든 Pod
    ports:
    - protocol: TCP
      port: 4143  # Linkerd inbound proxy port
  egress:
  # Linkerd control plane과의 통신 허용
  - to:
    - namespaceSelector:
        matchLabels:
          name: linkerd
    ports:
    - protocol: TCP
      port: 8086  # linkerd-dst
    - protocol: TCP
      port: 8080  # linkerd-identity
    - protocol: TCP
      port: 8090  # linkerd-policy
    - protocol: TCP
      port: 443   # linkerd-policy-validator
  # Linkerd proxy 간 통신 허용 (같은 네임스페이스 내)
  - to:
    - podSelector: {}  # 같은 네임스페이스의 모든 Pod
    ports:
    - protocol: TCP
      port: 4143  # Linkerd inbound proxy port

