<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>로그인</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/form.css">
    <script src="/js/storage.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const form = document.getElementById('loginForm');
        form.addEventListener('submit', async function(e){
          e.preventDefault();
          
          const formData = new FormData(form);
          const data = {
            username: formData.get('id'),
            password: formData.get('password')
          };

          try {
            const response = await fetch('/api/auth/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(data)
            });

            // Content-Type 확인
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
              const text = await response.text();
              throw new Error(`서버가 JSON을 반환하지 않았습니다. (${response.status}): ${text.substring(0, 100)}`);
            }

            const result = await response.json();
            
            if (!response.ok) {
              throw new Error(result.message || '로그인에 실패했습니다.');
            }

            // 로그인 성공 시 토큰 저장 (로컬 스토리지 또는 쿠키에 저장)
            if (result.token) {
              localStorage.setItem('token', result.token);
              localStorage.setItem('user', JSON.stringify(result.user));
            }
            
            alert('로그인 성공!');
            location.href = '/';
          } catch (error) {
            console.error('로그인 오류:', error);
            alert(error.message || '로그인 중 오류가 발생했습니다.');
          }
        });
      });
    </script>
  </head>
  <body>
    <header class="banner"><h1><a href="/" style="color:inherit;text-decoration:none;">내일의 발견</a></h1></header>
    <div class="form-card">
      <h2 class="form-title">로그인</h2>
      <form id="loginForm">
        <label>ID</label>
        <input name="id" required>
        <label>비밀번호</label>
        <input name="password" type="password" required>
        <div class="btn-row">
          <button type="submit" style="padding:12px 24px;font-size:1.1rem;">로그인</button>
          <a class="btn" href="/signup.html" style="padding:12px 24px;font-size:1.1rem;display:inline-block;">회원가입</a>
        </div>
      </form>
    </div>
  </body>
  </html>


